plugins:
  source:
      - module: intake_xarray
sources:
  pco2_Takahashi:
    driver: netcdf
    description: Takahashi climatology on different grids
    parameters:
      s_res:
        description: 'spatial resolution'
        type: str
        default: 'GR15'
        allowed: ['GR15', '1deg','R2B6']
    args:
      urlpath: '/work/mh0727/data/pCO2/pco2_taka_{{s_res}}.nc'
      decode_times: False

  dust_Mahowald:
    driver: netcdf
    parameters:
      s_res:
        description: 'spatial resolution'
        type: str
        default: 'GR15'
        allowed: ['GR15', 'GR30','TOY','TP04','TP10','TP6M']
      version:
        description: 'version as str'
        type: str
        default: '2005'
        allowed: ['2005','r2']
    args:
      urlpath: '/work/mh0727/data/DUST/{{s_res}}_MAHOWALDDUST_{{version}}.nc'
      decode_times: False
    metadata:
      plots:
        monthly_climatology:
          title: Mahowald monthly climatology
          kind: contourf
          x: 'lon'
          y: 'lat'
          z: 'DUST'
          groupby: 'time'

  dust_Albani2016:
    description: 'Simulated dust fields from Albani et al. 2016 (GRL);
                  Albani, S., N.M. Mahowald, L.N. Murphy, R. Raiswell, J.K. Moore, R.F. Anderson, D. McGee, L.I. Bradtmiller, B. Delmonte, P.P. Hesse, and P.A. Mayewski (2016). Paleodust variability since the Last Glacial Maximum and implications for iron inputs to the ocean. Geophys. Res. Lett., 43, 3944–3954, doi:10.1002/2016GL067911'
    driver: netcdf
    parameters:
      s_res:
        description: 'spatial resolution'
        type: str
        default: 'GR15'
        allowed: ['GR15', 'GR30','TOY','TP04','TP10']
    args:
      urlpath: '/work/mh0727/data/DUST/Albanietal2016_GRL_dustdep.{{s_res}}.nc'
      decode_times: False
    metadata:
      url_origin: doi:10.1002/2016GL067911

  SOMFFN:
    driver: netcdf
    args:
      urlpath: '/work/mh0727/data/SOCOM/gridded_data/SOM-FFN/pco2_1982-2015_MPI_SOM-FFN_GCB2016.nc'
      chunks: {'time':12}
      drop_variables: date
    metadata:
      fields:
        fgco2:
          label: fgco2
          unit: mol m-2 yr-1
        spco2:
          label: sea surface pCO2
          unit: uatm
      plots:
        fgco2_over_time:
          title: 'SOM-FFN fgco2 over time'
          kind: contourf
          x: 'lon'
          y: 'lat'
          z: 'fgco2'
          groupby: 'time'
          width: 800
          height: 400
          cmap: 'RdBu_r'
          levels: 20
        fgco2_timeseries_location:
          title: fgco2 timeseries at (lon,lat) location
          kind: line
          x: 'time'
          y: 'fgco2'
          groupby: ['lon','lat']
        fgco2_timeseries_latitude:
          title: fgco2 timeseries at latitude
          kind: contourf
          y: 'time'
          x: 'lon'
          z: 'fgco2'
          groupby: 'lat'
          levels: 20

  UEA_SI:
    driver: netcdf
    args:
      urlpath: '/work/mh0727/data/SOCOM/gridded_data/UEA-SI/statistical_gap-filled_fco2_v1-0_20150910.nc'
      chunks: {'time':12}
    metadata:
      readme: '/work/mh0727/data/SOCOM/gridded_data/UEA-SI/README'
      fields:
        fco2:
          label: fco2
          unit: uatm

  fgco2_JMA_MLR:
    driver: netcdf
    args:
      urlpath: '/work/mh0727/data/SOCOM/gridded_data/JMA-MLR/JMA_co2map1990-2015_v2_0.nc'
      chunks: {'time':12}
    metadata:
      readme: '/work/mh0727/data/SOCOM/gridded_data/JMA-MLR/README'

  JenaMLS:
    driver: netcdf
    metadata:
      readme: '/work/mh0727/data/SOCOM/gridded_data/Jena-MLS/README'
      fields:
        co2flux_land:
          label: Land-atmosphere co2 flux
          unit: PgC/yr
        co2flux_ocean:
          label: Ocean-atmosphere co2 flux
          unit: PgC/yr
    parameters:
      version:
        description: 'version'
        type: str
        default: 'v1.5_daily'
        allowed: ['v1.4','v1.5_daily','v1.5_pCO2_daily']
    args:
      urlpath: '/work/mh0727/data/SOCOM/gridded_data/Jena-MLS/oc_{{version}}.nc'
      chunks: {'time':12}

  SOCOM_biomes:
    driver: netcdf
    description: biome aggregates
    metadata:
      url_origin: 'http://www.bgc-jena.mpg.de/SOCOM'
      readme: '/work/mh0727/data/SOCOM/README'
      fields:
        meanf:
          label: spco2
          unit: uatm
        mmeanf:
          label: spco2
          unit: uatm
        fluxf:
          label: fgco2
          unit: PgC/yr
        mfluxf:
          label: fgco2
          unit: PgC/month
    parameters:
      product:
        description: 'product name'
        type: str
        default: 'ETH-SOMFFN'
        allowed: ['ETH-SOMFFN','AOML-EMP','CARBONES-NN','CU-SCSE','Jena-MLS13','JMA-MLR','NIES-NN','NIES-OTTM','OceanFlux-SI','PU-MCMC','UEA-SI','UEx-MRL','UNSW-SOMLO']
      biome:
        description: 'biome index'
        type: int
        default: 0
        allowed: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
    args:
      urlpath: '/work/mh0727/data/SOCOM/biome_timeseries/{{product}}.{{biome}}.nc'
      concat_dim: 'biome'
      decode_times: False
  SOCOM_all_products:
    driver: netcdf
    description: biome aggregates
    metadata:
      url_origin: 'http://www.bgc-jena.mpg.de/SOCOM'
      readme: '/work/mh0727/data/SOCOM/README'
      fields:
        taxis:
          label: Time
        meanf:
          label: spco2
        fluxf:
          label: fgco2
      plots:
        fgco2_over_time:
          title: 'SOCOM products: fgco2 in a biome over time'
          kind: line
          x: taxis
          y: meanf
        spco2_over_time:
          title: 'SOCOM products: spco2 in a biome over time'
          kind: line
          x: taxis
          y: fluxf
    parameters:
      biome:
        description: 'biome index'
        type: int
        default: 0
        allowed: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
    args:
      urlpath: '/work/mh0727/data/SOCOM/biome_timeseries/*.{{biome}}.nc'
      concat_dim: 'product'
      decode_times: False


  zmld.IFREMER:
    driver: netcdf
    args:
      urlpath: '/work/mh0727/data/MixedLayer/mld_DT02.nc'

  zmld.Levitus:
    description: 'Potential density (pd) criterion 0.125 in sigma units, Mixed Layer Depths
by Grigory Monterey, Sydney Levitus'
    driver: netcdf
    origin: https://www.nodc.noaa.gov/OC5/WOA94/mix.html
    args:
      urlpath: '/work/mh0727/data/MixedLayer/mld_pd_0125.nc'

  WOCE_stations:
    driver: csv

  WOD:
    driver: netcdf
    parameters:
      var:
        description: variable name
        type: str
        default: CFC11
        allowed: [CFC11,CFC12,deltaC13]
    s_res:
      parameters:
        description: spatial resolution
        type: str
        default: 1deg
        allowed: 1deg
    args:
      urlpath: /work/mh0727/data/WOD/WOD_{{var}}_{{s_res}}.nc
      drop_variables: time

  WOA13:
    driver: netcdf
    description: World Ocean Atlas
    parameters:
      t_res:
        description: temporal resolution
        type: str
        default: annual # seasonal doesnt have taxis
        allowed: [annual,month,seasonal] # monthly vs month
      s_res:
        description: spatial resolution
        type: str
        default: GR15
        allowed: ['GR15','1deg','R2B6L64','TP04']
      var:
        description: variable name
        type: str
        default: nitrate
        allowed: ['nitrate','dissolved_oxygen','apparent_oxygen_utilization','phosphate','salinity','silicate','temperature']
    args:
      urlpath: /work/mh0727/data/WOA/{{t_res}}/woa13_{{var}}_{{t_res}}_{{s_res}}.nc
      decode_times: False
      drop_variables: [lon_bnds, lat_bnds, depth_bnds,bnds,climatology_bnds,climatology_bounds]
    metadata:
      url_origin: https://www.nodc.noaa.gov/OC5/woa13/
      fields:
        n_an:
          label: nitrate
          unit: 10-6 mol / l
        i_an:
          label: silicate
          unit: 10-6 mol / l
        p_an:
          label: phospate
          unit: 10-6 mol / l
        t_an:
          label: temperature
          unit: °C
        s_an:
          label: salinity
          unit: psu
        o_an:
          label: volume fraction of oxygen in sea water
          unit: ml / l
        A_an:
          label: apparent oxygen utilization
          unit: ml / l
      plots:
        climatology:
          kind: contourf
          x: lon
          y: lat
  CO2:
    description: CO2 Mauna Loa
    driver: csv
    metadata:
      url_origin: https://cdiac.ess-dive.lbl.gov/trends/co2/sio-mlo.html
    args:
      urlpath: http://cdiac.ess-dive.lbl.gov/ftp/trends/co2/maunaloa.co2
      delimiter: ','
      header: 54
      names: ['Year','Month','Date1','Date','CO2_measured','CO2_rm_seasonality','CO2-4th_harmonic_linear_gain','Col8','Col9','Col10']
      #).drop([0,1,2,3,729,730,731,732,733])
      #.apply(pd.to_numeric).replace(-99.99,method='bfill')
  Levitus_tanom:
    description: ICDC
    driver: netcdf
    metadata:
      fields:
        t_an:
          label: temperature anomaly
          unit: °C
    args:
      urlpath: /pool/data/ICDC/ocean/levitus/DATA/tanom/yearly/tanom_*.nc
      concat_dim: time
      drop_variables: [lat_bnds,lon_bnds,depth_bnds,climatology_bounds,crs]
      decode_times: False
  Levitus_sanom:
    description: ICDC
    driver: netcdf
    metadata:
      fields:
        s_an:
          label: salinity anomaly
          unit: psu
    args:
      urlpath: /pool/data/ICDC/ocean/levitus/DATA/sanom/sanom_*.nc
      concat_dim: time
      drop_variables: [lat_bnds,lon_bnds,depth_bnds,climatology_bounds,crs]
      decode_times: False
  Levitus_OHC:
    description: ICDC
    driver: netcdf
    parameters:
      depth:
        description: depth levels of integral
        type: str
        default: 0-700
        allowed: [0-700,0-2000]
    metadata:
      fields:
        h18_hc:
          label: Ocean heat content anomaly
          unit: 10^18_joules
    args:
      urlpath: /pool/data/ICDC/ocean/levitus/DATA/heat_content/heat_content_anomaly_{{depth}}_yearly.nc
      concat_dim: time
      drop_variables: [lat_bnds,depth,lon_bnds,depth_bnds,climatology_bounds,crs]
      decode_times: False
  MODIS:
    description: ICDC MODIS monthly
    driver: netcdf
    metadata:
      fields:
        chla:
          label: Chlorophyll-a concentration at sea surface (OCI algorithm)
          unit: mg m-3
    parameters:
      surface:
        description: which bands aqua or terra
        type: str
        default: aqua
        allowed: [aqua, terra]
      var:
        description: variable name
        type: str
        default: chl
        allowed: [chl, sst]
    args:
      urlpath: /pool/data/ICDC/ocean/modis_{{surface}}_{{var}}/DATA/monthly/*/MODIS*.nc
      concat_dim: time
  AVISO:
    description: ICDC SSH
    driver: netcdf
    args:
      urlpath: /pool/data/ICDC/ocean/aviso_ssh/DATA/*/dt_global_twosat_phy_l4_*.nc
      drop_variables: [lat_bnds, lon_bnds,nv,ugoas,adt,vgos,err,vgosa,crs]
      concat_dim: time
  HadISST:
    description: hadisst
    driver: netcdf
    parameters:
      var:
        description: varname
        type: str
        default: sst
        allowed: ['sst','ice']
    args:
      urlpath: /pool/data/ICDC/ocean/hadisst1/DATA/HadISST_{{var}}.nc
      drop_variables: [time_bnds,nv]
  OSCAR_surface_currents:
    driver: netcdf
    description: global near-surface current estimates
    metadata:
      url_origin: http://icdc.cen.uni-hamburg.de/1/daten/ocean/oscar-oceansurfacecurrent.html
    parameters:
      s_res:
        description: spatial resolution
        type: str
        default: 1degree
        allowed: [1degree,1third_degree]
    args:
      urlpath: /pool/data/ICDC/ocean/oscar_surface_current_velocity/DATA/{{s_res}}/*oscar_vel*.nc
      concat_dim: time
      drop_variables: depth
  HadCRUT3:
    driver: netcdf
    description: HadCRUT3 Surface (Air) Temperature Anomalies
    metadata:
      url_origin: http://icdc.cen.uni-hamburg.de/1/daten/atmosphere/crutem-and-hadcrut.html
    parameters:
      version:
        description: version
        type: str
        default: '3'
        allowed: [3,3v]
    args:
      urlpath: /pool/data/ICDC/atmosphere/hadcrut/DATA/hadcrut{{version}}/HadCRUT{{version}}.nc
      drop_variables: [field_status, unspecified]
  HadCRUT4:
    driver: netcdf
    description: HadCRUT Surface (Air) Temperature Anomalies
    metadata:
      url_origin: http://icdc.cen.uni-hamburg.de/1/daten/atmosphere/crutem-and-hadcrut.html
    parameters:
      out:
        description: type of output
        type: str
        default: median
        allowed: [median, uncorrelated, uncorrleated_supplementary]
    args:
      urlpath: /pool/data/ICDC/atmosphere/hadcrut/DATA/hadcrut4/HadCRUT.4.6.0.0.{{out}}.nc
      drop_variables: [field_status, unspecified]
  # indices
  NINO3:
    driver: csv
    args:
      urlpath: https://www.esrl.noaa.gov/psd/data/correlation/nina3.data
      csv_kwargs:
        skiprows: 1
        #index_col: 0
        sep: ' '
        names: ['Year','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
  PDO:
    driver: csv
    args:
      urlpath: https://www.esrl.noaa.gov/psd/data/correlation/pdo.data
      csv_kwargs:
        skiprows: 1
        #index_col: 0
        sep: '\t'
        names: ['Year','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
  SAM:
    driver: csv
    args:
      urlpath: http://www.nerc-bas.ac.uk/public/icd/gjma/newsam.1957.2007.txt
      csv_kwargs:
        header: 1
        #index_col: 0
        sep: '\t'
        names: ['Year','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
